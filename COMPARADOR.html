<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NTO ¬∑ Comparador de Psicod√©licos Terap√™uticos</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Apache ECharts (gr√°ficos interativos, sem React) -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <style>
    :root { color-scheme: light dark; }
    html, body { height: 100%; }
    body { margin: 0; }
    .nto-glow { box-shadow: 0 0 30px rgba(139,92,246,.35); }
  </style>
</head>
<body class="bg-white text-neutral-900 dark:bg-black dark:text-neutral-100">
  <div id="app" class="min-h-screen bg-gradient-to-b from-white via-fuchsia-50 to-white dark:from-[#0b0b10] dark:via-[#140022] dark:to-black">
    <!-- Topbar -->
    <header class="sticky top-0 z-40 backdrop-blur bg-black/85 text-white border-b border-neutral-800">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <!-- Logo NTO (SVG) -->
          <svg width="140" height="60" viewBox="0 0 200 100" class="drop-shadow">
            <defs>
              <linearGradient id="ntoG" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#d946ef" /><stop offset="50%" stop-color="#7c3aed" /><stop offset="100%" stop-color="#22d3ee" />
              </linearGradient>
            </defs>
            <text x="0" y="65" font-family="serif" font-size="60" fill="#fff">N T</text>
            <circle cx="150" cy="50" r="28" stroke="url(#ntoG)" stroke-width="10" fill="none" />
          </svg>
          <div>
            <h1 class="text-lg font-semibold bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-600 via-violet-600 to-cyan-500">NTO ¬∑ Comparador de Psicod√©licos Terap√™uticos</h1>
            <p class="text-xs text-neutral-300">Cetamina ‚Ä¢ Ibogaina ‚Ä¢ Ayahuasca (DMT) ‚Ä¢ LSD ‚Ä¢ Psilocibina</p>
          </div>
        </div>
        <div class="hidden md:flex items-center gap-2">
          <button data-tab="cards" class="tab-btn nto-glow bg-white/10 border border-white/20 hover:bg-white/20 px-4 py-2 rounded-xl text-sm">‚ÑπÔ∏è Cart√µes</button>
          <button data-tab="table" class="tab-btn bg-white/10 border border-white/20 hover:bg-white/20 px-4 py-2 rounded-xl text-sm">üìñ Tabela</button>
          <button data-tab="charts" class="tab-btn bg-white/10 border border-white/20 hover:bg-white/20 px-4 py-2 rounded-xl text-sm">üìä Gr√°ficos</button>
        </div>
        <div class="flex items-center gap-3">
          <div class="relative">
            <span class="absolute left-2 top-2.5 text-xs">üîé</span>
            <input id="q" class="pl-8 pr-3 py-2 rounded-xl text-sm border border-neutral-700 bg-neutral-900 text-white w-52" placeholder="Buscar..." />
          </div>
          <div class="hidden sm:flex items-center gap-2">
            <span>üß∞</span>
            <select id="indicacao" class="text-sm rounded-xl border border-neutral-700 bg-neutral-900 text-white px-2 py-2"></select>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-xs">‚òÄÔ∏è</span>
            <button id="theme" class="w-12 h-6 rounded-full relative bg-neutral-300"><span class="dot absolute top-0.5 left-0.5 h-5 w-5 rounded-full bg-white transition"></span></button>
            <span class="text-xs">üåô</span>
          </div>
        </div>
      </div>
      <div class="md:hidden px-4 pb-3 flex items-center gap-2">
        <button data-tab="cards" class="tab-btn nto-glow bg-white/10 border border-white/20 hover:bg-white/20 px-3 py-1.5 rounded-xl text-sm">‚ÑπÔ∏è Cart√µes</button>
        <button data-tab="table" class="tab-btn bg-white/10 border border-white/20 hover:bg-white/20 px-3 py-1.5 rounded-xl text-sm">üìñ Tabela</button>
        <button data-tab="charts" class="tab-btn bg-white/10 border border-white/20 hover:bg-white/20 px-3 py-1.5 rounded-xl text-sm">üìä Gr√°ficos</button>
      </div>
    </header>

    <!-- Main -->
    <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <!-- Aviso -->
      <section class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/90 dark:bg-neutral-950/80 nto-glow backdrop-blur p-5">
        <div class="flex items-start gap-3"><div class="mt-1">‚ö†Ô∏è</div><div class="text-sm leading-relaxed"><b>Aviso:</b> material educativo para profissionais. N√£o descreve posologia. Legisla√ß√£o varia por pa√≠s/estado.</div></div>
      </section>

      <!-- Views -->
      <section id="view-cards" class="space-y-4"></section>
      <section id="view-table" class="hidden"></section>
      <section id="view-charts" class="hidden space-y-4">
        <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/90 dark:bg-neutral-950/80 nto-glow backdrop-blur p-5">
          <h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-2">In√≠cio √ó Dura√ß√£o (via mais comum)</h3>
          <div id="chart-scatter" style="height:380px;"></div>
          <p class="mt-2 text-xs text-neutral-500">Rosa: in√≠cio &lt;30 min e dura√ß√£o ‚â§180 min. Ciano: dura√ß√£o &gt;360 min.</p>
        </div>
        <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/90 dark:bg-neutral-950/80 nto-glow backdrop-blur p-5">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm uppercase tracking-wide text-neutral-500">Perfil de alvos ‚Äî Radar</h3>
            <div id="radar-legend" class="flex flex-wrap gap-2 text-xs"></div>
          </div>
          <div id="chart-radar" style="height:420px;"></div>
        </div>
        <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/90 dark:bg-neutral-950/80 nto-glow backdrop-blur p-5">
          <h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-2">Perfil de alvos ‚Äî Barras empilhadas</h3>
          <div id="chart-bars" style="height:420px;"></div>
        </div>
      </section>

      <!-- Tests -->
      <section id="tests" class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/90 dark:bg-neutral-950/80 nto-glow backdrop-blur p-5"></section>

      <div class="text-xs text-neutral-500 pt-2">¬© <span id="year"></span> ‚Äì NTO ‚Ä¢ Comparador de Psicod√©licos Terap√™uticos</div>
    </main>
    <footer class="border-t border-neutral-200 dark:border-neutral-800 mt-8">
      <div class="max-w-7xl mx-auto px-4 py-6 text-xs text-neutral-500 flex items-center justify-between">
        <span>¬© <span id="year2"></span> ‚Äì NTO</span>
        <a href="#" class="hover:underline" onclick="event.preventDefault()">Refer√™ncias gerais ‚Üó</a>
      </div>
    </footer>
  </div>

  <script>
    // =========================
    // Dados e paleta
    // =========================
    const DATA = [
      { id:'ketamine',  nome:'Cetamina', classe:'Anest√©sico dissociativo',
        principaisAlvos:{ NMDA:5, '5-HT2A':1, KOR:1, AMPA:3, DAT_SERT:1, Sigma:2 },
        mecanismo:'Antagonista NMDA; downstream AMPA; neuroplasticidade r√°pida (BDNF/mTOR).',
        formato:'IV/IM/IN; esketamina aprovada; uso off-label em alguns pa√≠ses.',
        indicacoes:['Depress√£o resistente','Idea√ß√£o suicida aguda','Dor cr√¥nica (selecionado)','Anestesia'],
        inicio:{ iv:1, oral:20 }, duracao:{ iv:45, oral:120 },
        janelaTerapeutica:'Antidepressivo r√°pido; requer manuten√ß√£o.',
        riscos:['PA/FC ‚Üë transit√≥ria','N√°usea/tontura/dissocia√ß√£o','Uso recreativo/depend√™ncia','Cistite cr√¥nica (altas doses)'],
        contra:['HAS n√£o controlada','Cardiopatia inst√°vel','Hist√≥ria de psicose n√£o tratada','Gravidez'],
        legal:'Esketamina aprovada (TRD) em v√°rios pa√≠ses; no Brasil, uso especializado.', evidencias:'S√≥lidas para TRD e suicidalidade.'
      },
      { id:'ibogaine',  nome:'Ibogaina', classe:'Alcaloide ind√≥lico',
        principaisAlvos:{ NMDA:3, '5-HT2A':2, KOR:4, AMPA:1, DAT_SERT:2, Sigma:3 },
        mecanismo:'Pleiotr√≥pica (NMDA/KOR/sigma/SERT). Noribogaina com t1/2 longo.',
        formato:'Extrato/iso; n√£o aprovado na maioria dos pa√≠ses.',
        indicacoes:['Depend√™ncia (investigacional)','Depress√£o (preliminar)'],
        inicio:{ iv:null, oral:60 }, duracao:{ iv:null, oral:1440 },
        janelaTerapeutica:'Efeitos subagudos por dias.',
        riscos:['Arritmia/QT prolongado','V√¥mitos/desidrata√ß√£o','Hepatotoxicidade'],
        contra:['QT prolongado/drogas que prolongam QT','Dist√∫rbios eletrol√≠ticos','Gravidez'],
        legal:'N√£o aprovado (BR: n√£o aprovado).', evidencias:'Promissoras por√©m heterog√™neas; riscos card√≠acos relevantes.'
      },
      { id:'ayahuasca', nome:'Ayahuasca (DMT+MAOI)', classe:'Decoc√ß√£o tradicional amaz√¥nica',
        principaisAlvos:{ NMDA:1, '5-HT2A':4, KOR:1, AMPA:1, DAT_SERT:2, Sigma:1 },
        mecanismo:'DMT agonista 5-HT; harmina/harmalina inibem MAO-A.',
        formato:'Bebida sacramental/ritual.',
        indicacoes:['Depress√£o (pequenos estudos)','Uso problem√°tico de subst√¢ncias','Crescimento/insight'],
        inicio:{ iv:null, oral:30 }, duracao:{ iv:null, oral:240 },
        janelaTerapeutica:'Efeitos psicossociais persistentes.',
        riscos:['Intera√ß√µes com serotonin√©rgicos','Crise hipertensiva/hipertermia','N√°usea/v√¥mitos intensos'],
        contra:['Transtorno psic√≥tico/mania ativa','Uso de ISRS/IMAO/triptanos/MDMA','Cardiopatia significativa','Gravidez'],
        legal:'Exce√ß√µes religiosas em alguns pa√≠ses (BR: uso religioso regulamentado).', evidencias:'Ensaios pequenos sugerem benef√≠cio.'
      },
      { id:'lsd',       nome:'LSD', classe:'Lisergamida cl√°ssica',
        principaisAlvos:{ NMDA:1, '5-HT2A':5, KOR:1, AMPA:1, DAT_SERT:2, Sigma:1 },
        mecanismo:'Agonista parcial 5-HT2A; plasticidade e flexibilidade cognitiva.',
        formato:'Uso cl√≠nico restrito √† pesquisa.',
        indicacoes:['Depress√£o/ansiedade (pesquisa)','Cefaleia em salvas','Transtornos por √°lcool (hist√≥rico)'],
        inicio:{ iv:null, oral:45 }, duracao:{ iv:null, oral:720 },
        janelaTerapeutica:'Mudan√ßas dependem de integra√ß√£o.',
        riscos:['Ansiedade aguda/p√¢nico','Mania/psicose em vulner√°veis','Raros eventos vasculares?'],
        contra:['TB I/psicose n√£o estabilizada','Cardiopatia estrutural','Gravidez'],
        legal:'Controlada (BR: proibido fora de pesquisa).', evidencias:'Crescente, ainda limitada.'
      },
      { id:'psilocybin', nome:'Psilocibina', classe:'Triptafeno psicod√©lico',
        principaisAlvos:{ NMDA:1, '5-HT2A':5, KOR:1, AMPA:1, DAT_SERT:2, Sigma:1 },
        mecanismo:'Agonista 5-HT dominante; reorganiza√ß√£o de redes.',
        formato:'Uso investigacional; aprova√ß√µes pontuais.',
        indicacoes:['Depress√£o maior/TRD','Ansiedade em doen√ßas graves','Depend√™ncia (preliminar)'],
        inicio:{ iv:null, oral:30 }, duracao:{ iv:null, oral:360 },
        janelaTerapeutica:'Resposta sustentada ap√≥s 1‚Äì2 sess√µes + psicoterapia.',
        riscos:['Ansiedade aguda','N√°usea/cefaleia','Mania/psicose em predispostos'],
        contra:['TB I/psicose n√£o estabilizada','Intera√ß√µes com ISRS (avaliar)','Gravidez'],
        legal:'Evolu√ß√£o regulat√≥ria em curso (BR: controlada).', evidencias:'V√°rios RCTs positivos; padroniza√ß√£o necess√°ria.'
      },
    ];

    const COLORS = {
      default:   { stroke:'#7c3aed', fill:'rgba(124,58,237,.25)',  bg:'from-neutral-200/30 to-neutral-100/30', emoji:'‚ú®' },
      ketamine:  { stroke:'#3b82f6', fill:'rgba(59,130,246,.25)',  bg:'from-blue-500/10 to-blue-300/10',       emoji:'üí†' },
      ibogaine:  { stroke:'#f59e0b', fill:'rgba(245,158,11,.25)',  bg:'from-amber-500/10 to-amber-300/10',     emoji:'üåø' },
      ayahuasca: { stroke:'#10b981', fill:'rgba(16,185,129,.25)',  bg:'from-emerald-500/10 to-emerald-300/10', emoji:'üçÉ' },
      lsd:       { stroke:'#a855f7', fill:'rgba(168,85,247,.25)',  bg:'from-violet-500/10 to-fuchsia-300/10',  emoji:'üåÄ' },
      psilocybin:{ stroke:'#ec4899', fill:'rgba(236,72,153,.25)',  bg:'from-pink-500/10 to-rose-300/10',       emoji:'üçÑ' },
    };

    // =========================
    // Estado simples (sem framework)
    // =========================
    const state = {
      tab: 'cards',
      q: '',
      indicacao: '',
      dark: true,
      radarActive: new Set(DATA.map(d=>d.id)),
    };

    // =========================
    // Helpers
    // =========================
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const byId = (id) => DATA.find(d=>d.id===id);

    function applyTheme() {
      const root = document.documentElement;
      const btn = $('#theme');
      if (state.dark) { root.classList.add('dark'); btn.classList.remove('bg-neutral-300'); btn.classList.add('bg-white'); btn.querySelector('.dot').style.left='calc(100% - 1.75rem)'; btn.querySelector('.dot').style.background='#000'; }
      else { root.classList.remove('dark'); btn.classList.add('bg-neutral-300'); btn.classList.remove('bg-white'); btn.querySelector('.dot').style.left='0.125rem'; btn.querySelector('.dot').style.background='#fff'; }
      renderCharts();
    }

    function filterData() {
      const q = state.q.trim().toLowerCase();
      return DATA.filter(d=>{
        const text = [d.nome,d.classe,d.mecanismo,d.indicacoes.join(' '),d.riscos.join(' '),d.contra.join(' ')].join(' ').toLowerCase();
        const matchQ = q? text.includes(q): true;
        const matchI = state.indicacao? d.indicacoes.includes(state.indicacao): true;
        return matchQ && matchI;
      });
    }

    // =========================
    // Render: Cart√µes
    // =========================
    function renderCards() {
      const cont = $('#view-cards');
      const items = filterData();
      cont.innerHTML = '';
      const grid = document.createElement('div');
      grid.className = 'grid md:grid-cols-2 lg:grid-cols-3 gap-4';
      items.forEach(d=>{
        const c = COLORS[d.id]||COLORS.default;
        const card = document.createElement('div');
        card.className = 'rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/90 dark:bg-neutral-950/80 nto-glow backdrop-blur p-5';
        card.innerHTML = `
          <div class="mb-3">
            <div class="rounded-xl px-3 py-2 bg-gradient-to-r ${c.bg} border border-neutral-200 dark:border-neutral-800 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="text-xl">${c.emoji}</span>
                <h2 class="text-lg font-semibold">${d.nome}</h2>
              </div>
              <span class="px-2 py-0.5 rounded-full text-xs bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700">${d.classe}</span>
            </div>
            <div class="mt-3 grid sm:grid-cols-2 gap-3 text-xs">
              ${statBar('In√≠cio (via + comum)', (d.inicio.oral||d.inicio.iv||0), 120, c.stroke)}
              ${statBar('Dura√ß√£o (via + comum)', (d.duracao.oral||d.duracao.iv||0), 800, c.stroke)}
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3 text-sm">
            <div>
              <h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-1">Mecanismo</h3>
              <p class="text-neutral-700 dark:text-neutral-300">${d.mecanismo}</p>
            </div>
            <div>
              <h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-1">In√≠cio & dura√ß√£o</h3>
              <div class="flex flex-wrap gap-2">
                ${d.inicio.iv? pill(`In√≠cio IV ~ ${d.inicio.iv} min`):''}
                ${d.inicio.oral? pill(`In√≠cio oral ~ ${d.inicio.oral} min`):''}
                ${d.duracao.iv? pill(`Dura√ß√£o IV ~ ${d.duracao.iv} min`):''}
                ${d.duracao.oral? pill(`Dura√ß√£o oral ~ ${d.duracao.oral} min`):''}
              </div>
              <p class="mt-2 text-neutral-700 dark:text-neutral-300 text-sm">${d.janelaTerapeutica||''}</p>
            </div>
            <div>
              <h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-1">Evid√™ncias</h3>
              <p class="text-neutral-700 dark:text-neutral-300">${d.evidencias||''}</p>
            </div>
            <div>
              <h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-1">Formato/Contexto</h3>
              <p class="text-neutral-700 dark:text-neutral-300">${d.formato||''}</p>
            </div>
          </div>
          <div class="mt-4 grid md:grid-cols-2 gap-3">
            <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/90 dark:bg-neutral-950/80 p-4">
              <h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-1">Riscos comuns</h3>
              <ul class="list-disc pl-5 text-sm space-y-1">${d.riscos.map(x=>`<li>${x}</li>`).join('')}</ul>
            </div>
            <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/90 dark:bg-neutral-950/80 p-4">
              <h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-1">Contraindica√ß√µes</h3>
              <ul class="list-disc pl-5 text-sm space-y-1">${d.contra.map(x=>`<li>${x}</li>`).join('')}</ul>
            </div>
          </div>
          <div class="mt-4 flex flex-wrap items-center gap-2">${d.indicacoes.map(i=>badge(i)).join('')}</div>
          <div class="mt-4 text-xs text-neutral-500"><b>Status legal:</b> ${d.legal||''}</div>
          ${d.notas? `<div class="mt-2 text-xs text-neutral-500"><b>Notas cl√≠nicas:</b> ${d.notas}</div>`: ''}
          <div class="mt-3 h-1.5 w-full rounded-full bg-gradient-to-r ${c.bg}"></div>
        `;
        grid.appendChild(card);
      });
      cont.appendChild(grid);
    }

    function pill(txt){ return `<span class="px-2 py-1 rounded-full text-xs bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700">${txt}</span>`; }
    function badge(txt){ return `<span class="px-2 py-0.5 rounded-full text-xs bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700">${txt}</span>`; }
    function statBar(label, value, max, color){
      const pct = Math.max(0, Math.min(100, (value/max)*100));
      return `<div>
        <div class="flex justify-between"><span class="text-neutral-500">${label}</span><span>${value} min</span></div>
        <div class="h-2 rounded-full bg-neutral-200 dark:bg-neutral-800 overflow-hidden">
          <div class="h-2" style="width:${pct}%;background:${color}"></div>
        </div>
      </div>`;
    }

    // =========================
    // Render: Tabela
    // =========================
    function renderTable(){
      const cont = $('#view-table');
      const items = filterData();
      cont.innerHTML = `<div class="overflow-auto">
        <table class="w-full text-sm border-collapse">
          <thead class="sticky top-0 bg-neutral-50 dark:bg-neutral-900">
            <tr class="text-left border-b border-neutral-200 dark:border-neutral-800">
              ${['Composto','Classe','Mecanismo','In√≠cio (oral)','Dura√ß√£o (oral)','Indica√ß√µes','Riscos','Contraindica√ß√µes','Status legal'].map(h=>`<th class="px-3 py-2 font-semibold">${h}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
            ${items.map(d=>`
              <tr class="border-b border-neutral-200 dark:border-neutral-800 align-top">
                <td class="px-3 py-2 font-medium">${d.nome}</td>
                <td class="px-3 py-2">${d.classe}</td>
                <td class="px-3 py-2">${d.mecanismo}</td>
                <td class="px-3 py-2">${d.inicio.oral? d.inicio.oral+' min':'‚Äî'}</td>
                <td class="px-3 py-2">${d.duracao.oral? d.duracao.oral+' min':'‚Äî'}</td>
                <td class="px-3 py-2">${d.indicacoes.join(', ')}</td>
                <td class="px-3 py-2">${d.riscos.join('; ')}</td>
                <td class="px-3 py-2">${d.contra.join('; ')}</td>
                <td class="px-3 py-2">${d.legal}</td>
              </tr>`).join('')}
          </tbody>
        </table>
      </div>`;
    }

    // =========================
    // Gr√°ficos (ECharts)
    // =========================
    let chartScatter, chartRadar, chartBars;

    function makeThemeColors(){
      const dark = state.dark;
      return {
        axis: dark? '#cbd5e1' : '#475569',
        grid: dark? '#1f2937' : '#e5e7eb',
        text: dark? '#e5e7eb' : '#111827',
        bg:   'transparent',
      };
    }

    function renderCharts(){
      const colors = makeThemeColors();
      // Scatter
      const sEl = document.getElementById('chart-scatter');
      if (!chartScatter) chartScatter = echarts.init(sEl, null, { renderer:'canvas' }); else chartScatter.resize();
      const sData = filterData().map(d=>({
        name: d.nome,
        value: [ (d.inicio.oral??d.inicio.iv??0), (d.duracao.oral??d.duracao.iv??0) ],
        itemStyle:{ color: (COLORS[d.id]||COLORS.default).stroke }
      }));
      chartScatter.setOption({
        backgroundColor: colors.bg,
        tooltip: { trigger:'item', formatter: p=>`${p.name}<br/>In√≠cio: ${p.value[0]} min<br/>Dura√ß√£o: ${p.value[1]} min` },
        grid: { left: 40, right: 20, top: 20, bottom: 40 },
        xAxis: { name:'In√≠cio (min)', nameLocation:'middle', nameGap:26, axisLine:{ lineStyle:{ color:colors.axis } }, axisLabel:{ color:colors.axis }, splitLine:{ lineStyle:{ color: '#9992' } } },
        yAxis: { name:'Dura√ß√£o (min)', nameLocation:'middle', nameGap:36, axisLine:{ lineStyle:{ color:colors.axis } }, axisLabel:{ color:colors.axis }, splitLine:{ lineStyle:{ color: '#9992' } } },
        series: [{ type:'scatter', data:sData, symbolSize: 14, emphasis:{ focus:'series' }, label:{ show:true, position:'top', formatter:(p)=>p.name, color:colors.text } }],
      });

      // Radar
      const rEl = document.getElementById('chart-radar');
      if (!chartRadar) chartRadar = echarts.init(rEl); else chartRadar.resize();
      const indicators = ['5-HT2A','NMDA','AMPA','KOR','DAT_SERT','Sigma'].map(n=>({ name:n, max:5 }));
      const radarSeries = Array.from(state.radarActive).map(id=>{
        const d = byId(id); const c = COLORS[id]||COLORS.default;
        return { name: d.nome, value: [d.principaisAlvos['5-HT2A'], d.principaisAlvos['NMDA'], d.principaisAlvos['AMPA'], d.principaisAlvos['KOR'], d.principaisAlvos['DAT_SERT'], d.principaisAlvos['Sigma']], areaStyle:{ opacity:.18, color:c.fill }, lineStyle:{ color:c.stroke }, itemStyle:{ color:c.stroke } };
      });
      chartRadar.setOption({
        backgroundColor: colors.bg,
        tooltip: { trigger:'item' },
        legend: { show:false },
        radar: { indicator: indicators, axisName: { color: colors.axis }, splitLine: { lineStyle:{ color:'#9993' } }, splitArea:{ areaStyle:{ color:['transparent'] } }, axisLine:{ lineStyle:{ color:'#9993' } } },
        series: [{ type:'radar', data: radarSeries }]
      });

      // Barras
      const bEl = document.getElementById('chart-bars');
      if (!chartBars) chartBars = echarts.init(bEl); else chartBars.resize();
      const items = filterData();
      const cats = items.map(d=>d.nome);
      const keys = ['5-HT2A','NMDA','AMPA','KOR','DAT_SERT','Sigma'];
      const series = keys.map(k=>({
        name:k, type:'bar', stack:'targets', emphasis:{ focus:'series' }, data: items.map(d=>d.principaisAlvos[k]),
      }));
      chartBars.setOption({
        backgroundColor: colors.bg,
        tooltip:{ trigger:'axis' },
        legend:{ textStyle:{ color:colors.axis } },
        grid:{ left: 40, right: 20, top: 30, bottom: 60 },
        xAxis:{ type:'category', data: cats, axisLabel:{ color:colors.axis, rotate: -10 } },
        yAxis:{ type:'value', min:0, max:5, axisLabel:{ color:colors.axis } },
        series
      });

      // Legend checkboxes for radar
      const legend = document.getElementById('radar-legend');
      legend.innerHTML = '';
      DATA.forEach(d=>{
        const c = COLORS[d.id]||COLORS.default;
        const wrap = document.createElement('label');
        wrap.className = 'flex items-center gap-1 cursor-pointer';
        wrap.innerHTML = `<input type="checkbox" ${state.radarActive.has(d.id)?'checked':''} data-radar="${d.id}" class="accent-fuchsia-600"/> <span>${d.nome}</span>`;
        legend.appendChild(wrap);
      });
    }

    // =========================
    // Tests (smoke)
    // =========================
    function renderTests(){
      const items = DATA;
      const hasAllKeys = items.every(d=>['5-HT2A','NMDA','AMPA','KOR','DAT_SERT','Sigma'].every(k=>k in d.principaisAlvos));
      const valuesInRange = items.every(d=>Object.values(d.principaisAlvos).every(v=>v>=0 && v<=5));
      const uniqueNames = new Set(items.map(d=>d.nome)).size === items.length;
      const positiveDurations = items.every(d=> (d.duracao.oral||d.duracao.iv||0)>0 && (d.inicio.oral||d.inicio.iv||0)>=0 );
      const tests = [
        { name:'Tem 5 compostos', pass: items.length===5 },
        { name:'Cada item tem nome e classe', pass: items.every(d=>d.nome && d.classe) },
        { name:'Gr√°ficos calculam in√≠cio/dura√ß√£o', pass: items.every(d=> (d.inicio.iv!==null || d.inicio.oral!==null) && (d.duracao.iv!==null || d.duracao.oral!==null) ) },
        { name:'Alvos: todas as chaves presentes', pass: hasAllKeys },
        { name:'Alvos: valores 0‚Äì5', pass: valuesInRange },
        { name:'Nomes √∫nicos', pass: uniqueNames },
        { name:'Dura√ß√£o positiva', pass: positiveDurations },
      ];
      const el = document.getElementById('tests');
      el.innerHTML = `<h3 class="text-sm uppercase tracking-wide text-neutral-500 mb-2">Verifica√ß√µes r√°pidas</h3>
        <div class="flex flex-wrap gap-3 text-sm">${tests.map(t=>`<div class="flex items-center gap-1"><span class="${t.pass?'text-emerald-500':'text-rose-500'}">${t.pass?'‚úîÔ∏è':'‚ùå'}</span><span>${t.name}</span></div>`).join('')}</div>`;
    }

    // =========================
    // Tabs / Filtros
    // =========================
    function switchTab(tab){ state.tab = tab; ['view-cards','view-table','view-charts'].forEach(id=>document.getElementById(id).classList.add('hidden')); if(tab==='cards') $('#view-cards').classList.remove('hidden'); if(tab==='table') $('#view-table').classList.remove('hidden'); if(tab==='charts') $('#view-charts').classList.remove('hidden'); $$('.tab-btn').forEach(b=>b.classList.remove('nto-glow')); $(`.tab-btn[data-tab="${tab}"]`).classList.add('nto-glow'); if(tab==='cards') renderCards(); if(tab==='table') renderTable(); if(tab==='charts') renderCharts(); }

    // =========================
    // Boot
    // =========================
    function boot(){
      // popular select de indica√ß√µes
      const all = Array.from(new Set(DATA.flatMap(d=>d.indicacoes))).sort();
      const sel = document.getElementById('indicacao');
      sel.innerHTML = `<option value="">Todas as indica√ß√µes</option>` + all.map(i=>`<option value="${i}">${i}</option>`).join('');

      // eventos
      $$('#theme').forEach? null : null; // noop para evitar warnings
      document.getElementById('theme').addEventListener('click', ()=>{ state.dark = !state.dark; applyTheme(); });
      document.getElementById('q').addEventListener('input', (e)=>{ state.q = e.target.value; if(state.tab==='cards') renderCards(); if(state.tab==='table') renderTable(); if(state.tab==='charts') renderCharts(); });
      sel.addEventListener('change', (e)=>{ state.indicacao = e.target.value; if(state.tab==='cards') renderCards(); if(state.tab==='table') renderTable(); if(state.tab==='charts') renderCharts(); });
      $$('.tab-btn').forEach(btn=>btn.addEventListener('click', ()=> switchTab(btn.dataset.tab)));
      document.getElementById('radar-legend').addEventListener('change', (e)=>{ const id = e.target.getAttribute('data-radar'); if(!id) return; if(e.target.checked) state.radarActive.add(id); else state.radarActive.delete(id); renderCharts(); });

      // datas do rodap√©
      const y = new Date().getFullYear(); document.getElementById('year').textContent = y; document.getElementById('year2').textContent = y;

      // inicial
      applyTheme();
      switchTab('cards');
      renderTests();
      window.addEventListener('resize', ()=>{ if(chartScatter) chartScatter.resize(); if(chartRadar) chartRadar.resize(); if(chartBars) chartBars.resize(); });
    }

    if (document.readyState !== 'loading') boot(); else document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
