import React, { useMemo, useState } from "react";

/**
 * NTOBR.com ‚Äì Preview de site em uma √∫nica p√°gina (React + Tailwind)
 * - Estrutura de navega√ß√£o (Home, Blog, Biblioteca, Cursos, Sobre, Contato)
 * - Logo NTO (releitura vetorial com anel arco-√≠ris) ‚Äì substitu√≠vel por PNG oficial
 * - cards de posts com exemplos reais de conte√∫do
 * - busca local (t√≠tulo, tags) e filtro por categoria
 * - leitor de post simplificado
 *
 * Como usar a sua logo oficial:
 * 1) Substitua o componente <LogoNTO/> por <img src="/sua-logo.png" alt="NTO" className="h-9"/> em <Header/>.
 * 2) Ajuste o tamanho conforme sua necessidade.
 */

// ====== DADOS EXEMPLO ======
const posts = [
  {
    id: "psilocibina-depressao-2025",
    title: "Psilocibina na depress√£o resistente: o que j√° sabemos em 2025",
    excerpt:
      "Panorama das evid√™ncias cl√≠nicas, par√¢metros de set & setting e pontos de seguran√ßa para profissionais.",
    tag: "Revis√£o",
    readTime: 9,
    date: "2025-09-01",
    coverEmoji: "üçÑ",
    keywords: ["psilocibina", "depress√£o", "ensaios cl√≠nicos"],
    body:
      "Resumo cr√≠tico de estudos fase II/III, endpoints de resposta e remiss√£o, compara√ß√£o com ISRS, e diretrizes pr√°ticas de triagem, titula√ß√£o e follow‚Äëup. Inclui mapa de riscos (psicose, mania, idea√ß√£o), intera√ß√µes medicamentosas e checklist de seguran√ßa pr√©‚Äësess√£o.",
  },
  {
    id: "mapeando-riscos-seguranca",
    title: "Mapeando riscos: seguran√ßa em terapias assistidas por psicod√©licos",
    excerpt:
      "Framework de seguran√ßa (bio-psico-social), contratos terap√™uticos, manejo de eventos adversos e crit√©rios de exclus√£o.",
    tag: "Guia",
    readTime: 8,
    date: "2025-09-03",
    coverEmoji: "üõ°Ô∏è",
    keywords: ["seguran√ßa", "riscos", "guia"],
    body:
      "Checklist para triagem, consentimento informado, preparo, presen√ßa de equipe, monitoriza√ß√£o e cuidados p√≥s‚Äësess√£o. Inclui matriz de gravidade x probabilidade para tomada de decis√£o cl√≠nica.",
  },
  {
    id: "mdma-tept-status",
    title: "MDMA e TEPT: onde estamos agora?",
    excerpt:
      "Atualiza√ß√£o do pipeline regulat√≥rio, qualidade de evid√™ncia e boas pr√°ticas para integra√ß√£o psicoterap√™utica.",
    tag: "Panorama",
    readTime: 7,
    date: "2025-09-05",
    coverEmoji: "üí†",
    keywords: ["MDMA", "TEPT", "regula√ß√£o"],
    body:
      "Discuss√£o sobre endpoints funcionais, escore CAPS‚Äë5, desenho de estudos e nuances de comorbidades (uso de subst√¢ncias, TCE).",  
  },
  {
    id: "ketamina-ambulatorial",
    title: "Cetamina ambulatorial: protocolo enxuto e seguro",
    excerpt:
      "Do screening ao follow‚Äëup: par√¢metros m√≠nimos, documenta√ß√£o e fluxos operacionais.",
    tag: "Protocolo",
    readTime: 6,
    date: "2025-09-07",
    coverEmoji: "üíâ",
    keywords: ["cetamina", "protocolo", "operacional"],
    body:
      "Algoritmo de decis√£o, doseamento inicial, monitoriza√ß√£o, crit√©rios de alta, red flags e template de evolu√ß√£o/consentimento.",
  },
  {
    id: "neuroetica-psicodelicos",
    title: "Neuro√©tica dos psicod√©licos: autonomia, risco e acesso",
    excerpt:
      "Quest√µes √©ticas centrais: justi√ßa distributiva, vulnerabilidade, hype versus evid√™ncia e conflitos de interesse.",
    tag: "Opini√£o",
    readTime: 5,
    date: "2025-09-09",
    coverEmoji: "‚öñÔ∏è",
    keywords: ["√©tica", "acesso", "regula√ß√£o"],
    body:
      "Reflex√£o sobre modelos de acesso, forma√ß√£o de profissionais, e responsabilidades de comunica√ß√£o p√∫blica.",
  },
  {
    id: "microdosing-verdades-mitos",
    title: "Microdosing: verdades, mitos e o que falta estudar",
    excerpt:
      "Onde a evid√™ncia √© s√≥lida e onde ainda h√° vi√©s ou efeito placebo? Como estudar melhor sem perder o contexto ecol√≥gico.",
    tag: "Explainer",
    readTime: 6,
    date: "2025-09-10",
    coverEmoji: "üß™",
    keywords: ["microdosing", "placebo", "metodologia"],
    body:
      "Resumo de RCTs, estudos natural√≠sticos, limita√ß√µes metodol√≥gicas e desenho de futuros trials pragmaticamente √∫teis.",
  },
];

const categories = [
  { key: "all", label: "Todos" },
  { key: "Revis√£o", label: "Revis√£o" },
  { key: "Guia", label: "Guia" },
  { key: "Panorama", label: "Panorama" },
  { key: "Protocolo", label: "Protocolo" },
  { key: "Opini√£o", label: "Opini√£o" },
  { key: "Explainer", label: "Explainer" },
];

// ====== COMPONENTES DE √ÅTOMO ======
const RainbowRing: React.FC<{ size?: number; className?: string }> = ({ size = 44, className }) => (
  <svg
    width={size}
    height={size}
    viewBox="0 0 100 100"
    className={className}
    aria-hidden
  >
    <defs>
      <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stopColor="#0ea5e9"/>
        <stop offset="20%" stopColor="#22c55e"/>
        <stop offset="40%" stopColor="#eab308"/>
        <stop offset="60%" stopColor="#f97316"/>
        <stop offset="80%" stopColor="#ef4444"/>
        <stop offset="100%" stopColor="#8b5cf6"/>
      </linearGradient>
      <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
        <feMerge>
          <feMergeNode in="coloredBlur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <circle cx="50" cy="50" r="36" fill="none" stroke="url(#grad)" strokeWidth="14" filter="url(#glow)"/>
    <circle cx="50" cy="50" r="27" fill="transparent"/>
  </svg>
);

const LogoNTO: React.FC<{ className?: string }> = ({ className }) => (
  <div className={`flex items-center gap-2 ${className ?? ""}`}>
    <span className="text-3xl sm:text-4xl font-serif tracking-tight text-stone-900 leading-none">NT</span>
    <RainbowRing size={40} />
  </div>
);

const Chip: React.FC<{ children: React.ReactNode }> = ({ children }) => (
  <span className="inline-flex items-center rounded-full border border-stone-200 px-2 py-0.5 text-xs text-stone-700 bg-white/70 backdrop-blur">
    {children}
  </span>
);

// ====== CABE√áALHO / NAVEGA√á√ÉO ======
const Header: React.FC<{ view: string; setView: (v: string) => void }> = ({ view, setView }) => {
  const nav = [
    { key: "home", label: "In√≠cio" },
    { key: "blog", label: "Blog" },
    { key: "library", label: "Biblioteca" },
    { key: "courses", label: "Cursos" },
    { key: "about", label: "Sobre" },
    { key: "contact", label: "Contato" },
  ];
  return (
    <header className="sticky top-0 z-50 border-b border-stone-200/70 bg-stone-50/80 backdrop-blur">
      <div className="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
        <button className="flex items-center gap-2" onClick={() => setView("home")}>
          <LogoNTO />
        </button>
        <nav className="hidden md:flex gap-4 text-sm">
          {nav.map((n) => (
            <button
              key={n.key}
              onClick={() => setView(n.key)}
              className={`px-3 py-1 rounded-full transition hover:bg-white ${
                view === n.key ? "bg-white shadow-sm" : ""
              }`}
            >
              {n.label}
            </button>
          ))}
        </nav>
        <div className="flex items-center gap-2">
          <a
            href="#newsletter"
            className="rounded-full bg-stone-900 text-white text-sm px-3 py-1.5 shadow hover:shadow-md transition"
          >
            Assine a newsletter
          </a>
        </div>
      </div>
    </header>
  );
};

// ====== SE√á√ïES ======
const Hero: React.FC<{ setView: (v: string) => void }> = ({ setView }) => (
  <section className="relative">
    <div className="absolute inset-0 -z-10 from-transparent via-fuchsia-200/30 to-sky-200/30 bg-[radial-gradient(80%_50%_at_50%_0%,rgba(168,85,247,0.25)_0%,rgba(255,255,255,0)_60%)]"/>
    <div className="mx-auto max-w-6xl px-4 py-14 sm:py-20">
      <div className="flex flex-col items-start gap-6">
        <LogoNTO className="scale-110" />
        <h1 className="text-3xl sm:text-5xl font-semibold tracking-tight text-stone-900 max-w-3xl">
          Observat√≥rio do Mundo Psicod√©lico no Brasil
        </h1>
        <p className="text-stone-700 max-w-2xl">
          Educa√ß√£o baseada em evid√™ncias, sem hype. Conte√∫do cl√≠nico, √©tico e pr√°tico para profissionais e curiosos ‚Äì com um leve toque psicod√©lico.
        </p>
        <div className="flex flex-wrap gap-3">
          <button onClick={() => setView("blog")} className="rounded-lg px-4 py-2 bg-stone-900 text-white shadow hover:shadow-md">Explorar o Blog</button>
          <button onClick={() => setView("courses")} className="rounded-lg px-4 py-2 bg-white border border-stone-300 shadow-sm hover:shadow">
            Ver futuros cursos
          </button>
        </div>
      </div>
    </div>
  </section>
);

const HighlightPosts: React.FC<{ onOpen: (id: string) => void }> = ({ onOpen }) => (
  <section className="mx-auto max-w-6xl px-4 pb-10">
    <div className="mb-6 flex items-center justify-between">
      <h2 className="text-xl font-semibold">Destaques do Blog</h2>
      <a className="text-sm text-stone-700 hover:text-stone-900" href="#" onClick={(e)=>{e.preventDefault(); onOpen(posts[0].id);}}>Ver um exemplo</a>
    </div>
    <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {posts.slice(0, 6).map((p) => (
        <article key={p.id} className="group rounded-2xl border border-stone-200 bg-white shadow-sm hover:shadow-md transition overflow-hidden">
          <div className="h-28 flex items-center justify-center text-5xl bg-gradient-to-tr from-amber-100 via-sky-100 to-fuchsia-100">
            <span className="select-none">{p.coverEmoji}</span>
          </div>
          <div className="p-4 flex flex-col gap-2">
            <div className="flex items-center gap-2 text-xs">
              <Chip>{p.tag}</Chip>
              <span className="text-stone-500">{p.readTime} min</span>
            </div>
            <h3 className="text-base font-semibold leading-snug line-clamp-2">{p.title}</h3>
            <p className="text-sm text-stone-700 line-clamp-2">{p.excerpt}</p>
            <button onClick={() => onOpen(p.id)} className="mt-2 text-sm text-stone-900 hover:underline text-left">Ler mais ‚Üí</button>
          </div>
        </article>
      ))}
    </div>
  </section>
);

const Newsletter: React.FC = () => (
  <section id="newsletter" className="relative">
    <div className="absolute inset-0 -z-10 bg-[radial-gradient(50%_50%_at_50%_50%,rgba(59,130,246,0.12)_0%,rgba(255,255,255,0)_60%)]"/>
    <div className="mx-auto max-w-6xl px-4 py-12">
      <div className="rounded-3xl border border-stone-200 bg-white/80 backdrop-blur p-6 sm:p-10 shadow">
        <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h3 className="text-lg font-semibold">Assine a newsletter NTO</h3>
            <p className="text-stone-700 text-sm">Uma curadoria semanal, sem spam. Estudos, not√≠cias e eventos.</p>
          </div>
          <form className="flex w-full sm:w-auto gap-2">
            <input className="w-full sm:w-80 rounded-xl border border-stone-300 bg-white px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-stone-400" placeholder="Seu melhor e-mail"/>
            <button className="rounded-xl bg-stone-900 text-white px-4 py-2 text-sm shadow hover:shadow-md">Quero receber</button>
          </form>
        </div>
      </div>
    </div>
  </section>
);

const Footer: React.FC<{ setView: (v: string) => void }> = ({ setView }) => (
  <footer className="border-t border-stone-200">
    <div className="mx-auto max-w-6xl px-4 py-10 grid gap-6 sm:grid-cols-2 lg:grid-cols-4 text-sm">
      <div>
        <LogoNTO />
        <p className="text-stone-700 mt-2">Observat√≥rio independente sobre psicod√©licos no Brasil.</p>
      </div>
      <div>
        <h4 className="font-semibold mb-2">Conte√∫do</h4>
        <ul className="space-y-1">
          <li><button className="hover:underline" onClick={()=>setView("blog")}>Blog</button></li>
          <li><button className="hover:underline" onClick={()=>setView("library")}>Biblioteca</button></li>
          <li><button className="hover:underline" onClick={()=>setView("courses")}>Cursos</button></li>
        </ul>
      </div>
      <div>
        <h4 className="font-semibold mb-2">Institucional</h4>
        <ul className="space-y-1">
          <li><button className="hover:underline" onClick={()=>setView("about")}>Sobre a NTO</button></li>
          <li><button className="hover:underline" onClick={()=>setView("contact")}>Contato</button></li>
        </ul>
      </div>
      <div>
        <h4 className="font-semibold mb-2">Siga</h4>
        <p className="text-stone-700">Instagram ¬∑ YouTube ¬∑ LinkedIn</p>
      </div>
    </div>
    <div className="text-center text-xs text-stone-500 pb-6">¬© {new Date().getFullYear()} NTO. Educa√ß√£o baseada em evid√™ncias.</div>
  </footer>
);

// ====== P√ÅGINAS SIMPLIFICADAS ======
const BlogView: React.FC<{ onOpen: (id: string) => void }> = ({ onOpen }) => {
  const [q, setQ] = useState("");
  const [cat, setCat] = useState("all");
  const filtered = useMemo(() => {
    return posts.filter((p) => {
      const matchQ = (p.title + " " + p.excerpt + " " + p.keywords.join(" ")).toLowerCase().includes(q.toLowerCase());
      const matchC = cat === "all" ? true : p.tag === cat;
      return matchQ && matchC;
    });
  }, [q, cat]);

  return (
    <section className="mx-auto max-w-6xl px-4 py-10">
      <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <h2 className="text-2xl font-semibold">Blog</h2>
        <div className="flex gap-2">
          <input value={q} onChange={(e)=>setQ(e.target.value)} placeholder="Buscar artigos..." className="w-64 rounded-xl border border-stone-300 bg-white px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-stone-400"/>
          <select value={cat} onChange={(e)=>setCat(e.target.value)} className="rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm">
            {categories.map(c => <option key={c.key} value={c.key}>{c.label}</option>)}
          </select>
        </div>
      </div>
      <p className="text-sm text-stone-700 mt-2">{filtered.length} artigo(s) encontrados.</p>
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 mt-6">
        {filtered.map((p) => (
          <article key={p.id} className="group rounded-2xl border border-stone-200 bg-white shadow-sm hover:shadow-md transition overflow-hidden">
            <div className="h-28 flex items-center justify-center text-5xl bg-gradient-to-tr from-amber-100 via-sky-100 to-fuchsia-100">
              <span className="select-none">{p.coverEmoji}</span>
            </div>
            <div className="p-4 flex flex-col gap-2">
              <div className="flex items-center gap-2 text-xs">
                <Chip>{p.tag}</Chip>
                <span className="text-stone-500">{p.readTime} min</span>
                <span className="text-stone-400">¬∑ {new Date(p.date).toLocaleDateString()}</span>
              </div>
              <h3 className="text-base font-semibold leading-snug">{p.title}</h3>
              <p className="text-sm text-stone-700 line-clamp-2">{p.excerpt}</p>
              <button onClick={() => onOpen(p.id)} className="mt-2 text-sm text-stone-900 hover:underline text-left">Ler mais ‚Üí</button>
            </div>
          </article>
        ))}
      </div>
    </section>
  );
};

const LibraryView: React.FC = () => (
  <section className="mx-auto max-w-6xl px-4 py-10">
    <h2 className="text-2xl font-semibold">Biblioteca</h2>
    <p className="text-stone-700 mt-2 max-w-2xl">Reposit√≥rio curado de artigos, revis√µes e documentos p√∫blicos. (Aqui voc√™ pode organizar por tipo de estudo, ano, interven√ß√£o e diagn√≥stico.)</p>
    <div className="mt-6 grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
      {["Ensaios cl√≠nicos", "Diretrizes e Position Papers", "Ci√™ncias b√°sicas", "Pol√≠tica e regula√ß√£o", "√âtica", "Ferramentas e checklists"].map((t) => (
        <div key={t} className="rounded-xl border border-stone-200 bg-white p-4 shadow-sm">
          <h3 className="font-medium">{t}</h3>
          <p className="text-sm text-stone-700">Em breve.</p>
        </div>
      ))}
    </div>
  </section>
);

const CoursesView: React.FC = () => (
  <section className="mx-auto max-w-6xl px-4 py-10">
    <h2 className="text-2xl font-semibold">Cursos</h2>
    <p className="text-stone-700 mt-2">Valida√ß√£o de interesse para turmas futuras. Deixe seu e-mail na newsletter para ser avisado.</p>
    <div className="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {[
        { title: "Cetamina: do protocolo √† pr√°tica", level: "Intermedi√°rio" },
        { title: "Psicod√©licos e seguran√ßa cl√≠nica", level: "Fundamental" },
        { title: "Integra√ß√£o psicoterap√™utica", level: "Avan√ßado" },
      ].map((c) => (
        <div key={c.title} className="rounded-2xl border border-stone-200 bg-white p-5 shadow-sm">
          <div className="flex items-center gap-2 mb-2">
            <RainbowRing size={22} />
            <h3 className="font-semibold">{c.title}</h3>
          </div>
          <p className="text-sm text-stone-700">N√≠vel: {c.level}</p>
          <button className="mt-3 text-sm underline">Quero ser avisado</button>
        </div>
      ))}
    </div>
  </section>
);

const AboutView: React.FC = () => (
  <section className="mx-auto max-w-6xl px-4 py-10">
    <h2 className="text-2xl font-semibold">Sobre a NTO</h2>
    <p className="text-stone-700 mt-2 max-w-3xl">
      A NTO √© um observat√≥rio independente focado em educa√ß√£o baseada em evid√™ncias sobre psicod√©licos no Brasil.
      Nossa est√©tica √© clean com um leve toque psicod√©lico (anel arco‚Äë√≠ris). Priorizamos rigor cient√≠fico, seguran√ßa e
      comunica√ß√£o acess√≠vel.
    </p>
  </section>
);

const ContactView: React.FC = () => (
  <section className="mx-auto max-w-6xl px-4 py-10">
    <h2 className="text-2xl font-semibold">Contato</h2>
    <form className="mt-4 grid gap-3 max-w-xl">
      <input placeholder="Seu nome" className="rounded-xl border border-stone-300 bg-white px-4 py-2 text-sm"/>
      <input placeholder="Seu e-mail" className="rounded-xl border border-stone-300 bg-white px-4 py-2 text-sm"/>
      <textarea placeholder="Mensagem" rows={5} className="rounded-xl border border-stone-300 bg-white px-4 py-2 text-sm"/>
      <button className="rounded-xl bg-stone-900 text-white px-4 py-2 text-sm w-fit">Enviar</button>
    </form>
  </section>
);

const PostReader: React.FC<{ id: string; onBack: () => void }> = ({ id, onBack }) => {
  const p = posts.find((x) => x.id === id)!;
  return (
    <section className="mx-auto max-w-3xl px-4 py-10">
      <button onClick={onBack} className="text-sm hover:underline">‚Üê Voltar</button>
      <div className="mt-3 flex items-center gap-2 text-xs">
        <Chip>{p.tag}</Chip>
        <span className="text-stone-500">{p.readTime} min</span>
        <span className="text-stone-400">¬∑ {new Date(p.date).toLocaleDateString()}</span>
      </div>
      <h1 className="mt-2 text-3xl font-semibold">{p.title}</h1>
      <div className="mt-4 rounded-xl border border-stone-200 bg-white p-5 shadow-sm">
        <p className="text-stone-800 leading-relaxed">
          {p.body}
        </p>
        <div className="mt-4 text-stone-500 text-sm">Palavras‚Äëchave: {p.keywords.join(", ")}</div>
      </div>
    </section>
  );
};

// ====== APP PRINCIPAL ======
export default function NTOPreview() {
  const [view, setView] = useState("home");
  const [openPost, setOpenPost] = useState<string | null>(null);

  return (
    <div className="min-h-screen bg-stone-50 text-stone-900">
      <Header view={view} setView={(v)=>{ setOpenPost(null); setView(v); }} />

      {view === "home" && (
        <>
          <Hero setView={setView} />
          <HighlightPosts onOpen={(id)=>{ setOpenPost(id); setView("blog"); }} />
          <Newsletter />
        </>
      )}

      {view === "blog" && (
        openPost ? (
          <PostReader id={openPost} onBack={()=> setOpenPost(null)} />
        ) : (
          <BlogView onOpen={(id)=> setOpenPost(id)} />
        )
      )}

      {view === "library" && <LibraryView />}
      {view === "courses" && <CoursesView />}
      {view === "about" && <AboutView />}
      {view === "contact" && <ContactView />}

      <Footer setView={setView} />
    </div>
  );
}
